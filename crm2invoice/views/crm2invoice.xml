<odoo>
    <data>
        <!-- relational field on ir.model.fields -->
        <!--record id="crm-relational-field-on-invoice" model="ir.model.fields">
            <field name="name">crm_field<field/>
            <field name="complete_name" eval="False"/>
            <field name="compute" eval="False"/>
            <field name="copy" eval="False"/>
            <field name="depends" eval="False"/>
            <field name="domain">[]</field>
            <field name="field_description">Lead/Opportunity</field>
            <field name="groups" eval="[(6, 0, [])]"/>
            <field name="help" eval="False"/>
            <field name="index" eval="False"/>
            <field name="model">account.invoice</field>
            <field name="model_id" ref="account.model_account_invoice"/>
            <field name="on_delete">set null</field>
            <field name="readonly" eval="False"/>
            <field name="related" eval="False"/>
            <field name="relation">crm.lead</field>
            <field name="relation_field" eval="False"/>
            <field name="required" eval="False"/>
            <field name="selectable" eval="True"/>
            <field name="selection" eval="False"/>
            <field name="size" eval="False"/>
            <field name="state">manual</field>
            <field name="store" eval="True"/>
            <field name="track_visibility" eval="False"/>
            <field name="translate" eval="False"/>
            <field name="ttype">many2one</field>
      </record-->

        <!-- crm field on account.invoice_form -->
        <record id="account.invoice_crm_lead"
                model="ir.ui.view">
            <field name="field_parent" eval="False"/>
            <field name="inherit_id" ref="account.invoice_form"/>
            <field name="mode">extension</field>
            <field name="model">account.invoice</field>
            <field name="name">account.crm_lead_form</field>
            <field name="priority">99</field>
            <field name="type">form</field>
            <field name="active" eval="True"/>
            <field name="arch" type="xml">
                <xpath expr="//field[@name='partner_id']" position="before">
                    <field name="crm_lead" attrs="{}" readonly="1"/>
                </xpath>
            </field>
        </record>

        <record id="crm.smart_invoices_button"
                model="ir.ui.view">
            <field name="inherit_id" ref="crm.crm_case_form_view_oppor"/>
            <field name="mode">extension</field>
            <field name="model">crm.lead</field>
            <field name="name">crm.lead.invoices.button.form</field>
            <field name="type">form</field>
            <field name="active" eval="True"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='toggle_active']" position="after">
                    <button class="oe_stat_button" icon="fa-diamond" type="action"
                            name="crm2invoice.crm_invoice_smart_action"
                            context="{'form_view_ref':'account.invoice_form', 'default_type':'out_invoice','type':'out_invoice', 'journal_type': 'sale', 'search_default_partner_id': partner_id, 'default_partner_id': partner_id, 'default_team_id': team_id, 'default_campaign_id': campaign_id, 'default_medium_id': medium_id, 'default_source_id': source_id}">
                        <field name="x_crm_lead__account_invoice_count" string="Invoices" widget="statinfo"/>
                    </button>
                </xpath>
            </field>
        </record>

        <record model="ir.actions.act_window" id="crm_invoice_smart_action">
            <field name="name">Invoices</field>
            <field name="res_model">account.invoice</field>
            <field name="view_mode">tree,form</field>
            <field name="domain">[('crm_lead', '=', active_id)]</field>
            <field name="context">{'search_default_crm_lead': active_id,'default_crm_lead': active_id}</field>
        </record>

        <record id="crm.new_invoice_button"
                model="ir.ui.view">
            <field name="inherit_id" ref="crm.crm_case_form_view_oppor"/>
            <field name="mode">extension</field>
            <field name="model">crm.lead</field>
            <field name="name">crm.lead.new.invoice.button.form</field>
            <field name="type">form</field>
            <field name="active" eval="True"/>
            <field name="arch" type="xml">
                <xpath expr="//button[@name='action_set_won_rainbowman']" position="before">
                    <button string="New Invoice" class="oe_highlight" type="action"
                            name="crm2invoice.crm_invoice_new_invoice_button_action"
                            context="{'form_view_ref':'account.invoice_form', 'default_type':'out_invoice','type':'out_invoice', 'journal_type': 'sale', 'search_default_partner_id': partner_id, 'default_partner_id': partner_id, 'default_team_id': team_id, 'default_campaign_id': campaign_id, 'default_medium_id': medium_id, 'default_source_id': source_id}">
                    </button>
                </xpath>
            </field>
        </record>

        <!--"NEW INVOICE" button as "NEW QUOTATION" -->
        <record model="ir.actions.act_window" id="crm_invoice_new_invoice_button_action">
            <field name="name">New Invoice</field>
            <field name="res_model">account.invoice</field>
            <field name="view_mode">form</field>
            <field name="target">new</field>
            <field name="domain">[('crm_lead', '=', active_id)]</field>
            <field name="context">{'search_default_crm_lead': active_id,'default_crm_lead': active_id}</field>
        </record>


    </data>
</odoo>
